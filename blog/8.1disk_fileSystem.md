### [目录](https://github.com/Letitmiss/Linux-learning/blob/master/README.md)
### [上一节 第7章 Linux档案与文件系统管理](https://github.com/Letitmiss/Linux-learning/blob/master/blog/7.1filedir.md)
-----
## 认识EXT2文件系统
[1. 磁盘组成与分割](#磁盘组成与分割)  <br/>
[2. 文件系统特性](#文件系统特性)   <br/>
[3. Linux的ext2文件系统inode](#文件系统的属性)   <br/>
[4. 文件系统与目录树的关系](#文件系统特性)   <br/>
[5. EXT2/EXT3的档案存取与日志式文件系统 ](#文件系统特性)   <br/>
[6. Linux文件系统的运作](#文件系统特性)   <br/>
[7. 挂载点的意义](#文件系统特性)   <br/>
[8. 其他linux支持的文件系统与VFS](#文件系统特性)   <br/>

----

## 磁盘组成与分割
### 磁盘组成
* 磁盘是由圆形的磁盘盘,机械手臂,机械手臂上都磁盘读取头,主轴马达组成
* 磁盘的物理组成
* ![此处有图]()
1. 扇区(Sector)为最小的物理存储单位,每个扇区为512bytes
2. 将扇区组成一个圆,就是磁柱(Cylinder),磁柱是分割槽的最小单位;
3. 第一个扇区最重要,记录了主引导分区(Master boot record,MRB),安装引导加载程序及分割表(partition),记录磁盘分区状态,MRB占有446bytes而partition则占有64bytes.
### 分区
* 所谓磁盘分区是指告诉操作系统在此分割槽可以存取的区域是有A磁柱到B磁柱之间的区块,在这个区块内进行读写搜寻操作,磁盘分区就指定分割槽的起始与结束磁柱就是.
* 指定分割槽的磁柱范围的信息记录在分割表中,分割表只有64bytes,最多只能记录四笔分割槽的记录,这四笔分割槽成为主要(Primary)或延伸(extended)分割槽,其中延伸分割槽还可以再分割出逻辑分割槽,而能被格式的则仅有主要分割槽与逻辑分割槽
1. 主要分割与延伸分割最多可以有四笔(硬盘的额限制)
2. 延伸分割最多只能有一个(操作系统限制)
3. 逻辑分割是由延伸分割持续切割出来的分割槽;
4. 能够被格式化后,作为数据存储的分割槽为主要分割与逻辑分割,延伸分割无法格式化
5. 逻辑分割的数量已操作系统而不同,在Linux系统中,IDE硬盘最多有59个逻辑分割(5-63),STAT硬盘则有11个逻辑分割(5-11)

## 文件系统特性
### 格式化
* 磁盘分区完毕后需要格式化,之后操作系统才可以使用这个分割槽,因为每种操作系统格式化设定的文件属性与权限并不相同,所以需要格式化为操作系统能够利用的文件系统filesystem
* 传统的分割槽只能被格式化一个文件系统,所以说一个filesystem就是一个partition,随着技术的进步,LVM可将一个分割槽格式化多个文件系统,软件磁盘阵列可以将多个分割槽合并为一个文件系统,所以目前格式化不再针对partition来格式化,通常称呼一个可被挂载的数据为一个文件系统而不是一个分割槽;

### 文件系统的inode与block
* 操作系统的档案数据除了档案的实际数据外,通常还有很多属性,例如linux操作系统的档案权限rwx与文件属性,文件系统通常会将两部分数据分别存放在不用的区块,属性与权限放到inode中,实际数据存放到data block中,另外还有一个超级区块(superblock)会记录整个文件系统的整体信息,包括inode与block的总量,使用量,剩余量.
* 每个inode与block都有编号,至于三个数据的意义:
1. superblock : 记录此filesystem的整体信息,包括inode/blockde总量,使用量,剩余量,以及与文件系统的格式与相关信息
2. inode : 记录档案的属性,一个档案占用一个inode,同时记录此档案所在的block号码
3. block : 实际记录档案的内容,若档案太大时,会占用多个block.

![inode与 block区块图解说明]

* 通过indoe编号中记录的block编号找到对应的block快,读取信息,这种文件系统成为索引式文件系统,block不宜太分散,碎片整理就是整理磁盘的block;EXT2就是索引式文件系统

## 文件系统的属性
### Linux的ext2文件系统inode

* 标准的linux文件系统ext2就是使用inode为基础文件系统,inode的内容记录了档案的权限与相关属性,至于block则是记录档案的实际内容.文件系统初始化的时候就将inode和block规划好了
* Ext2文件系统在格式化的时候基本都是区分为多个区块群组,给个区块群组都有独立的inode/block/superblock系统
* [inode/block/superblockt图示]
* 在文件系统规划中,文件系统最前面有一个启动扇区(boot sector),这个扇区安装开机管理程序,将不同的开机管理程序安装在这里可以不用覆盖MBR,可以制作多重引导换将

### data block(资料区块)
* data block 是用来放置档案内容数据地方,在Ext2文件系统中所支持的block大小有1k,2k及4k 三种
* 在格式化的时候block的大小就固定了,每一个block都有编号,方便inode记录
* block大小差异会导致文件系统支持最大磁盘容量和最大单一档案容量不一样

|Block大小|1KB|2KB|4KB|
|---|---|---|---|
|最大单一档案限制|16GB|256GB|2TB
|最大文件系统总容量|2TB|8TB|16TB
* ext2文件系统的block的基本限制
1. 原则上block的大小与数量在格式化后就不能再改变了
2. 每个block内最多只能够放置一个档案的数据
3. 如果档案大于block的大小,就会占用多个block
4. 如果档案小于block,则改block剩余的容量就不能再被使用了
### inode table(inode 表格)
* inode记录档案的数据至少有下面这些
1. 档案的存取模式(read/write/excute)
2. 档案的拥有者与群组(owner/group)
3. 档案的容量
4. 档案的建立或状态改变的时间(ctime)
5. 最近一次的读取时间(atime)
6. 最近一次的修改时间(mtime)
7. 档案的特性标识(flag),set UID
8. 档案真正的内容指向(pointer)
* inode的特色
1. inode的数量与大小在格式化时就已经固定了
2. 每个inode大小均固定为128bytes
3. 每个档案仅会占用一个inode
4. 承上,因此文件系统能够建立的档案数量与inode的数量有关
5. 系统读取档案时需要先找到inode,并分析inode所记录的权限与用户是否符合,若符合才能够开始实际读取内容

* inode存储block结构
1. 分析inode/block与档案大小的关系,inode需要记录的数据非常多,但是只有128bytes而inode记录一个block号需要4byte,假设档案由400M,每个block为4k,需要至少10万个block.远远超过inode的大小,inode是如何用128位存储block号码的? **系统将inode与记录block号码的区域定义为12个直接,一个间接,一个双间接与一个三间接记录区,看下图**
      
   ![indoe结构图]() 

2. inode中有12直接记录了block号码,间接记录就是使用一个block记录block号码,如果初始化block为1kb,就可以存储256个block号码,如说是双间接第一层间接就可以记录256个block号码.第二层间接256个block号每一个可以指向256个block区域,所以共记录了`256*256`个block号码,三间接类似;

3. block为1kb时计算指向block的容量
    * 直接 12K
    * 间接 256K
    * 双间接 `256*256`
    * 三间接 `256*256*256`
    * 总和 : `12K+256K+256*256K+256*256*256 = 16GB` 所以1k的block存储单个文件最大为16GB,block为2kb因为系统限制算出来结构不一样

### Superblock(超级块)


### [目录](https://github.com/Letitmiss/Linux-learning/blob/master/README.md)
### [上一节 8.2文件系统的简单操作](https://github.com/Letitmiss/Linux-learning/blob/master/blog/8.2disk_fileSystem.md)
------
# 磁盘的分割.格式化.检验与挂载
[1. 磁盘分区 fdisk,partprobe ](#磁盘与目录的容量)   
[2. 磁盘格式化 mkfs,mke2fs](#磁盘格式化)    
[3. 磁盘检验 fsck,badblocks](#磁盘检验)   
[4. 磁盘挂载与卸载 mount,umount](#磁盘挂载与卸载)   
[5. 磁盘参数修订 mknod,e2label,tune2fs,hdparm](#磁盘参数修订)   

----

## 磁盘与目录的容量
* 磁盘管理时,新增一块磁盘的动作如下:
1. 磁盘进行分割,建立可用的partition
2. 对partition进行格式化(format),建立系统可用的filesystem
3. 对刚刚建立好的filesystem进行检验
4. 在linux系统上,需要建立挂载点(挂载目录),将filesystem挂载上来
* 实际过程还要考虑分区槽parttion需要多大,是否加入Journal功能,inode与block的数量应该如何规划,这些实际问题根据主机的用途来考虑;

### 磁盘分区
* fdisk [-l] 装置名称
    * -l 后面接装置时输出改装置的所有的partition内容, 如果只是fdisk -l 时,则系统会把整个系统内能搜索到装置的partition均列出来
```bash
lfg1000708009:/ # df /            # 查看root挂载
Filesystem     1K-blocks     Used Available Use% Mounted on
/dev/vda2      138301480 31313612  99962564  24% /
lfg1000708009:/ # fdisk /dev/vda

Command (m for help): m        
Command action
   a   toggle a bootable flag
   b   edit bsd disklabel
   c   toggle the dos compatibility flag
   d   delete a partition           # 删除一个分区
   l   list known partition types   # 显示支持的分区类型
   m   print this menu
   n   add a new partition          # 增加一个分区
   o   create a new empty DOS partition table
   p   print the partition table     # 打印分区表
   q   quit without saving changes   # 不保存退出,就是操作不生效退出
   s   create a new empty Sun disklabel 
   t   change a partition's system id  # 修改分区类型
   u   change display/entry units
   v   verify the partition table
   w   write table to disk and exit    # 将刚刚的动作写入分割表
   x   extra functionality (experts only)

Command (m for help): p

Disk /dev/vda: 161.1 GB, 161061273600 bytes          # 磁盘文件名与容量
255 heads, 63 sectors/track, 19581 cylinders, total 314572800 sectors  #255个磁面(磁头),每个刺头管理63个扇区,19581个磁柱
Units = sectors of 1 * 512 = 512 bytes              # 一个扇区的大小
Sector size (logical/physical): 512 bytes / 512 bytes  # 每个扇区的大小
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0x0002407d  

   Device Boot      Start         End      Blocks   Id  System
/dev/vda1            2048    33560575    16779264   82  Linux swap / Solaris
/dev/vda2   *    33560576   314572799   140506112   83  Linux

Command (m for help): 
```
* 计算每个磁柱的大小 : 每个磁头管理63个扇区,各个扇区是512大小,一共有255给刺头,随意每个磁柱的大小为cylinder
  `63*512*255=8255280bytes` 计算磁盘大小 每个磁柱大小X磁柱数 即 `8255280*19581=161646637680Bytes`约161.1G
    一共有多少扇区:`63*19581*255=314568765`  与统计出来的数量不一样,大概差不多?
*　boot为 * 表示开机启动
*  Start为开始扇区  End为结束扇区, 查看资料很多系统这一列指的的开始磁柱和结束磁柱

### 删除磁盘分区槽
```bash
lfg1000708009:/ # fdisk /dev/vda
Command (m for help): p

Disk /dev/vda: 161.1 GB, 161061273600 bytes
255 heads, 63 sectors/track, 19581 cylinders, total 314572800 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0x0002407d

   Device Boot      Start         End      Blocks   Id  System
/dev/vda1            2048    33560575    16779264   82  Linux swap / Solaris
/dev/vda2   *    33560576   314572799   140506112   83  Linux

Command (m for help): d
Partition number (1-4): 4
Warning: partition 4 has empty type

Command (m for help): d            # 删除vda1
Partition number (1-4): 1

Command (m for help): p        # 查看已经删除

Disk /dev/vda: 161.1 GB, 161061273600 bytes
255 heads, 63 sectors/track, 19581 cylinders, total 314572800 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0x0002407d

   Device Boot      Start         End      Blocks   Id  System
/dev/vda2   *    33560576   314572799   140506112   83  Linux

Command (m for help): q          # 注意这里只是测试q退出

lfg1000708009:/ # 
```
### 新增磁盘分区槽
* 新增磁盘有好多中 primary,extended,logical的显示结果不一样
```bash
lfg1000708009:/ # fdisk /dev/sda  # 查看磁盘信息

Command (m for help): p

Disk /dev/sda: 161.1 GB, 161061273600 bytes
255 heads, 63 sectors/track, 19581 cylinders, total 314572800 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0x0002407d

   Device Boot      Start         End      Blocks   Id  System
/dev/sda1            2048    33560575    16779264   82  Linux swap / Solaris
/dev/sda2   *    33560576   314572799   140506112   83  Linux

Command (m for help): d             # 删除磁盘分区2
Partition number (1-4): 2

Command (m for help): d         # 只剩一个磁盘分区默认选中删除
Selected partition 1

Command (m for help): n     # 新增一个主分区primary分割槽
Command action               #因为是全新磁盘所以会问是新增主分区还是扩展分区
   e   extended
   p   primary partition (1-4)
p                          # 输入p选择新增主分区
Partition number (1-4, default 1): 4                # 指定主分区号码为4
First sector (2048-314572799, default 2048):         # 默认分配的扇区是从2048开始 输入enter
Using default value 2048
Last sector, +sectors or +size{K,M,G} (2048-314572799, default 314572799): +512M       # 输入+XX[KMG]系统会自动计算扇区大小,也可以自己计算扇区号码来输入,推荐使用输入空间大小,系统分配

Command (m for help): p          # 打印磁盘信息

Disk /dev/sda: 161.1 GB, 161061273600 bytes
255 heads, 63 sectors/track, 19581 cylinders, total 314572800 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0x0002407d

   Device Boot      Start         End      Blocks   Id  System            #只有磁盘分区4, 1~3分区是保留的
/dev/sda4            2048     1050623      524288    83  Linux

Command (m for help): n            # 新增扩展分区槽
Command action
   e   extended
   p   primary partition (1-4)
e                 # 输入e表示扩展分区
Partition number (1-4, default 1): 1           # 扩展分区号
First sector (1050624-314572799, default 1050624):            # 默认分区开始扇区 enter默认
Using default value 1050624
Last sector, +sectors or +size{K,M,G} (1050624-314572799, default 314572799):       # 默认扩展分区包含了所有的未分割空间enter
Using default value 314572799

Command (m for help): p                   #　查看分区，已经有一个主分区和一个扩展分区

Disk /dev/sda: 161.1 GB, 161061273600 bytes
255 heads, 63 sectors/track, 19581 cylinders, total 314572800 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0x0002407d

   Device Boot      Start         End      Blocks   Id  System
/dev/sda1         1050624   314572799   156761088    5  Extended
/dev/sda4            2048     1050623      524288   83  Linux

Partition table entries are not in disk order

Command (m for help): n　　　　# 新增分区,如果已经有了扩展分区就会显示选择逻辑分区　
Command action
   l   logical (5 or over)
   p   primary partition (1-4)
p                             #如果要增加primary 试试看
Partition number (1-4, default 2): 2    # 选择2 提示没有可用的扇区
No free sectors available 

Command (m for help): n     # 新增2GB的逻辑分区
Command action
   l   logical (5 or over)
   p   primary partition (1-4)
l                         #　新增逻辑分区
First sector (1052672-314572799, default 1052672): 　　　　　　　# 默认起始扇区enter确定
Using default value 1052672
Last sector, +sectors or +size{K,M,G} (1052672-314572799, default 314572799): +2048M  # 指定逻辑分区的大小
Command (m for help): p          # 查看分区 多了一个5号的逻辑分区
Disk /dev/sda: 161.1 GB, 161061273600 bytes
255 heads, 63 sectors/track, 19581 cylinders, total 314572800 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0x0002407d
   Device Boot      Start         End      Blocks   Id  System
/dev/sda1         1050624   314572799   156761088    5  Extended
/dev/sda4            2048     1050623      524288   83  Linux
/dev/sda5         1052672     5246975     2097152   83  Linux
Partition table entries are not in disk order
Command (m for help): q   #这里只是演示操作,切勿w否则系统会损坏;
lfg1000708009:/ # 

```
* 在实际分配磁盘的过程中, w使得磁盘的分配生效,系统会提示重启才会生效, 其实是因为核心无法重新取得分区表,才会要求我们重新启动reboot以更新核心的分区表信息, `partprobe` 指令可以强制让核心重新捕捉一次 分区表 partition table

* 在以root身份进行磁盘partition时,最好是在


## 磁盘格式化

## 磁盘检验

## 磁盘挂载与卸载
## 磁盘参数修订

